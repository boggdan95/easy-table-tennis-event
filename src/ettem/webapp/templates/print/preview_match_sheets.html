{% extends "print/preview.html" %}

{% block preview_content %}
{% for pair in matches_pairs %}
<div class="preview-page">
    {% for md in pair %}
    <div class="match-sheet-half">
        <!-- Header -->
        <div class="header">
            {% if branding and branding.logo_url %}
            <div style="margin-bottom: 3px;"><img src="{{ branding.logo_url }}" style="max-height: 30px;" alt=""></div>
            {% endif %}
            <h2>{% if branding and branding.official_name %}{{ branding.official_name }}{% else %}{{ tournament_name }}{% endif %}</h2>
            <div class="subtitle">
                {% if category %}{{ category }}{% endif %}
                {% if md.group_name %} - {{ md.group_name }}{% endif %}
            </div>
        </div>

        <!-- Match Info Row -->
        <div class="match-info-row">
            <div class="match-info-cell">
                <span class="info-label">MESA</span>
                <span class="info-value">{{ md.table_number if md.table_number else '___' }}</span>
            </div>
            <div class="match-info-cell">
                <span class="info-label">HORA</span>
                <span class="info-value">{{ md.scheduled_time if md.scheduled_time else '__:__' }}</span>
            </div>
            <div class="match-info-cell">
                <span class="info-label">PARTIDO</span>
                <span class="info-value">#{{ md.match.match_order if md.match.match_order else '___' }}</span>
            </div>
            <div class="match-info-cell">
                <span class="info-label">RONDA</span>
                <span class="info-value">{% if md.match.round_type and md.match.round_type not in ['group', 'RR'] %}{{ md.match.round_type }}{% elif md.group_name %}Grupo {{ md.group_name }} - R{{ md.round_number if md.round_number else md.match.match_order }}{% else %}Grupos{% endif %}</span>
            </div>
        </div>

        <!-- Players Compact -->
        <div class="players-compact">
            <div class="player-box">
                <div class="player-label">{% if is_doubles %}PAREJA A{% else %}JUGADOR A{% endif %}</div>
                <div class="player-name">{{ md.player1.nombre }} {{ md.player1.apellido }}</div>
                {% if country_colors and md.player1.pais_cd and country_colors.get(md.player1.pais_cd) %}
                <div class="player-country"><span style="background-color: {{ country_colors[md.player1.pais_cd] }}; color: white; padding: 0 3px; border-radius: 2px;">{{ md.player1.pais_cd }}</span></div>
                {% else %}
                <div class="player-country">({{ md.player1.pais_cd }})</div>
                {% endif %}
            </div>
            <div class="player-box">
                <div class="player-label">{% if is_doubles %}PAREJA B{% else %}JUGADOR B{% endif %}</div>
                <div class="player-name">{{ md.player2.nombre }} {{ md.player2.apellido }}</div>
                {% if country_colors and md.player2.pais_cd and country_colors.get(md.player2.pais_cd) %}
                <div class="player-country"><span style="background-color: {{ country_colors[md.player2.pais_cd] }}; color: white; padding: 0 3px; border-radius: 2px;">{{ md.player2.pais_cd }}</span></div>
                {% else %}
                <div class="player-country">({{ md.player2.pais_cd }})</div>
                {% endif %}
            </div>
        </div>

        <!-- Score Table Compact -->
        <table class="score-table">
            <thead>
                <tr>
                    <th class="player-col">{% if is_doubles %}Pareja{% else %}Jugador{% endif %}</th>
                    <th>S1</th>
                    <th>S2</th>
                    <th>S3</th>
                    <th>S4</th>
                    <th>S5</th>
                    <th>SETS</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="player-cell">{% if is_doubles %}{{ md.player1.nombre }} {{ md.player1.apellido }}{% else %}{{ md.player1.nombre[0] }}. {{ md.player1.apellido }}{% endif %}</td>
                    <td class="score-cell"></td>
                    <td class="score-cell"></td>
                    <td class="score-cell"></td>
                    <td class="score-cell"></td>
                    <td class="score-cell"></td>
                    <td class="total-cell"></td>
                </tr>
                <tr>
                    <td class="player-cell">{% if is_doubles %}{{ md.player2.nombre }} {{ md.player2.apellido }}{% else %}{{ md.player2.nombre[0] }}. {{ md.player2.apellido }}{% endif %}</td>
                    <td class="score-cell"></td>
                    <td class="score-cell"></td>
                    <td class="score-cell"></td>
                    <td class="score-cell"></td>
                    <td class="score-cell"></td>
                    <td class="total-cell"></td>
                </tr>
            </tbody>
        </table>

        <!-- Result Row -->
        <div class="result-row">
            <div class="result-box" style="flex: 2;">
                <span class="info-label">GANADOR</span>
                <span class="info-value">________________________</span>
            </div>
            <div class="result-box">
                <span class="info-label">RESULTADO</span>
                <span class="info-value">___ - ___</span>
            </div>
            <div class="result-box">
                <span class="info-label">WO</span>
                <span class="info-value">☐</span>
            </div>
        </div>

        <!-- Signatures -->
        <div class="signatures-row">
            <div class="signature-box">
                <div class="signature-line"></div>
                <div class="signature-label">{% if is_doubles %}Pareja A{% else %}Jugador A{% endif %}</div>
            </div>
            <div class="signature-box">
                <div class="signature-line"></div>
                <div class="signature-label">{% if is_doubles %}Pareja B{% else %}Jugador B{% endif %}</div>
            </div>
            <div class="signature-box">
                <div class="signature-line"></div>
                <div class="signature-label">Árbitro</div>
            </div>
        </div>
    </div>
    {% endfor %}

    {% if pair|length == 1 %}
    <!-- Empty half for odd matches -->
    <div class="match-sheet-half" style="border-style: dashed; opacity: 0.3;">
        <div style="text-align: center; padding: 3rem; color: #999;">
            (Espacio disponible)
        </div>
    </div>
    {% endif %}
</div>
{% endfor %}
{% endblock %}
