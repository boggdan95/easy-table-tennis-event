{% extends "base.html" %}
{% block title %}{% if match.status == 'pending' %}Ingresar{% else %}Editar{% endif %} Resultado - ETTEM{% endblock %}
{% block content %}
<h1>{% if match.status == 'pending' %}Ingresar{% else %}Editar{% endif %} Resultado del Partido</h1>
<h2>{{ player1.nombre }} {{ player1.apellido }} vs {{ player2.nombre }} {{ player2.apellido }}</h2>

{% if match.status != 'pending' %}
<div style="background: #fff3cd; padding: 10px; margin-bottom: 15px; border-radius: 5px;">
    ⚠️ Está editando un resultado existente. Los cambios sobrescribirán el resultado anterior.
</div>
{% endif %}

<form method="post" action="/match/{{ match.id }}/save-result">
    <h3>Sets (dejar vacio los no jugados)</h3>
    {% for i in range(1, 6) %}
    <div>
        <label>Set {{ i }}:</label>
        {% set set_data = match.sets[i-1] if match.sets and i <= match.sets|length else none %}
        <input type="number" name="set{{ i }}_p1" min="0" max="99"
               placeholder="{{ player1.apellido }}"
               {% if set_data %}value="{{ set_data.player1_points }}"{% endif %}>
        -
        <input type="number" name="set{{ i }}_p2" min="0" max="99"
               placeholder="{{ player2.apellido }}"
               {% if set_data %}value="{{ set_data.player2_points }}"{% endif %}>
    </div>
    {% endfor %}
    <div style="margin-top: 20px;">
        <label><input type="checkbox" name="is_walkover" value="true"
                      {% if match.status == 'WALKOVER' %}checked{% endif %}> Walkover (WO)</label>
        <label>Si WO, ganador:
            <select name="winner_id">
                <option value="">-</option>
                <option value="{{ player1.id }}"
                        {% if match.winner_id == player1.id %}selected{% endif %}>{{ player1.apellido }}</option>
                <option value="{{ player2.id }}"
                        {% if match.winner_id == player2.id %}selected{% endif %}>{{ player2.apellido }}</option>
            </select>
        </label>
    </div>
    <div style="margin-top: 20px;">
        <button type="submit" class="btn btn-success">Guardar Resultado</button>
        <a href="/group/{{ match.group_id }}/matches" class="btn">Cancelar</a>
    </div>
</form>
{% endblock %}
