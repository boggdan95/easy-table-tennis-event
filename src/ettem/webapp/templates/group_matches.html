{% extends "base.html" %}
{% from "_macros.html" import cc_badge with context %}

{% block title %}{{ t('nav.matches') }} {{ t('category.group') }} {{ group.name }} - {{ t('app.short_title') }}{% endblock %}

{% block page_title %}{{ t('category.group') }} {{ group.name }} - {{ t('nav.matches') }}{% endblock %}

{% block extra_head %}
<style>
    @keyframes pulse-badge {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.6; }
    }
    .badge-in-progress {
        background-color: #0d6efd !important;
        color: white !important;
        animation: pulse-badge 1.5s ease-in-out infinite;
    }
</style>
{% endblock %}

{% block topbar_actions %}
<a href="/category/{{ category }}" class="btn btn-secondary btn-sm">
    <span>‚Üê</span>
    <span>{{ t('common.back') }}</span>
</a>
{% endblock %}

{% block content %}
<!-- Navigation Card -->
<div class="card mb-3">
    <div class="card-body">
        <div class="d-flex gap-2">
            <a href="/group/{{ group.id }}/standings" class="btn btn-success">
                <span>üìä</span>
                <span>{{ t('category.view_standings') }}</span>
            </a>
            <a href="/group/{{ group.id }}/sheet" class="btn btn-secondary">
                <span>üìÑ</span>
                <span>{{ t('category.view_sheet') }}</span>
            </a>
        </div>
    </div>
</div>

<!-- Matches Table Card -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">{{ t('matches.title') }}</h3>
    </div>
    <div class="card-body" style="padding: 0;">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th style="width: 60px;">#</th>
                        <th style="width: 60px; text-align: center;">{{ t('groups.table') }}</th>
                        <th style="width: 70px; text-align: center;">{{ t('groups.time') }}</th>
                        <th>{{ t('matches.player1') }}</th>
                        <th style="width: 40px; text-align: center;">{{ t('matches.vs') }}</th>
                        <th>{{ t('matches.player2') }}</th>
                        <th style="width: 120px; text-align: center;">{{ t('matches.score') }}</th>
                        <th style="width: 120px; text-align: center;">{{ t('tournaments.status') }}</th>
                        <th style="width: 200px; text-align: center;">{{ t('common.actions') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for m in matches %}
                    <tr>
                        <td><span class="badge badge-secondary">{{ m.match.match_number }}</span></td>
                        <td style="text-align: center;">
                            {% if m.table_number %}
                                <span class="badge badge-primary">{{ m.table_number }}</span>
                            {% else %}
                                <span style="color: var(--text-muted);">-</span>
                            {% endif %}
                        </td>
                        <td style="text-align: center;">
                            {% if m.scheduled_time %}
                                <span class="badge badge-info">{{ m.scheduled_time }}</span>
                            {% else %}
                                <span style="color: var(--text-muted);">-</span>
                            {% endif %}
                        </td>
                        <td>
                            <strong>{{ m.player1.nombre }} {{ m.player1.apellido }}</strong>
                            <span style="margin-left: 0.5rem;">{{ cc_badge(m.player1.pais_cd) }}</span>
                        </td>
                        <td style="text-align: center; color: var(--text-muted);">{{ t('matches.vs') }}</td>
                        <td>
                            <strong>{{ m.player2.nombre }} {{ m.player2.apellido }}</strong>
                            <span style="margin-left: 0.5rem;">{{ cc_badge(m.player2.pais_cd) }}</span>
                        </td>
                        <td style="text-align: center;">
                            {% if m.match.status == 'WALKOVER' %}
                                {% if m.match.winner_id == m.player1.id %}
                                    <span class="badge badge-warning">3-0 (WO)</span>
                                {% else %}
                                    <span class="badge badge-warning">0-3 (WO)</span>
                                {% endif %}
                            {% elif m.match.status != 'pending' %}
                                <span class="badge badge-success" style="font-size: 1rem;">{{ m.player1_sets }}-{{ m.player2_sets }}</span>
                            {% else %}
                                <span class="badge badge-secondary">-</span>
                            {% endif %}
                        </td>
                        <td style="text-align: center;">
                            {% if m.match.status == 'pending' %}
                                <span class="badge badge-secondary">{{ t('matches.status.pending') }}</span>
                            {% elif m.match.status == 'in_progress' %}
                                <span class="badge badge-in-progress">{{ t('matches.status.in_progress') }}</span>
                            {% elif m.match.status == 'WALKOVER' %}
                                <span class="badge badge-warning">{{ t('matches.status.walkover') }}</span>
                            {% else %}
                                <span class="badge badge-success">{{ t('matches.status.completed') }}</span>
                            {% endif %}
                        </td>
                        <td style="text-align: center;">
                            <div class="d-flex gap-1" style="justify-content: center;">
                                {% if is_teams %}
                                    <a href="/team-match/{{ m.match.id }}"
                                       class="btn {% if m.match.status == 'pending' %}btn-success{% else %}btn-warning{% endif %} btn-sm"
                                       title="Encuentro de Equipos"
                                       style="padding: 0.25rem 0.5rem;">
                                        {% if m.match.status == 'pending' %}‚úì{% else %}‚úé{% endif %}
                                    </a>
                                {% elif m.match.status == 'pending' %}
                                    <a href="/match/{{ m.match.id }}/enter-result"
                                       class="btn btn-success btn-sm"
                                       title="{{ t('matches.enter_result') }}"
                                       style="padding: 0.25rem 0.5rem;">
                                        ‚úì
                                    </a>
                                {% else %}
                                    <a href="/match/{{ m.match.id }}/enter-result"
                                       class="btn btn-warning btn-sm"
                                       title="{{ t('matches.edit_result') }}"
                                       style="padding: 0.25rem 0.5rem;">
                                        ‚úé
                                    </a>
                                    <form action="/match/{{ m.match.id }}/delete-result" method="post" style="display:inline;" data-confirm="{{ t('matches.confirm_delete') }}">
                                        <button type="submit"
                                                class="btn btn-danger btn-sm"
                                                title="{{ t('matches.delete_result') }}"
                                                style="padding: 0.25rem 0.5rem;">
                                            ‚úï
                                        </button>
                                    </form>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Auto-refresh every 10 seconds for live updates -->
<script>
    setTimeout(function() {
        window.location.reload();
    }, 10000);
</script>
{% endblock %}
