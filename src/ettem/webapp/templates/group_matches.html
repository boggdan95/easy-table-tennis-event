{% extends "base.html" %}

{% block title %}Partidos Grupo {{ group.name }} - ETTEM{% endblock %}

{% block page_title %}Grupo {{ group.name }} - Partidos{% endblock %}

{% block topbar_actions %}
<a href="/category/{{ category }}" class="btn btn-secondary btn-sm">
    <span>‚Üê</span>
    <span>Volver</span>
</a>
{% endblock %}

{% block content %}
<!-- Navigation Card -->
<div class="card mb-3">
    <div class="card-body">
        <div class="d-flex gap-2">
            <a href="/group/{{ group.id }}/standings" class="btn btn-success">
                <span>üìä</span>
                <span>Ver Clasificaci√≥n</span>
            </a>
            <a href="/group/{{ group.id }}/sheet" class="btn btn-secondary">
                <span>üìÑ</span>
                <span>Ver Hoja de Grupo</span>
            </a>
        </div>
    </div>
</div>

<!-- Matches Table Card -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Lista de Partidos</h3>
    </div>
    <div class="card-body" style="padding: 0;">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th style="width: 60px;">#</th>
                        <th style="width: 60px; text-align: center;">Mesa</th>
                        <th style="width: 70px; text-align: center;">Hora</th>
                        <th>Jugador 1</th>
                        <th style="width: 40px; text-align: center;">vs</th>
                        <th>Jugador 2</th>
                        <th style="width: 120px; text-align: center;">Resultado</th>
                        <th style="width: 120px; text-align: center;">Estado</th>
                        <th style="width: 200px; text-align: center;">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for m in matches %}
                    <tr>
                        <td><span class="badge badge-secondary">{{ m.match.match_number }}</span></td>
                        <td style="text-align: center;">
                            {% if m.table_number %}
                                <span class="badge badge-primary">{{ m.table_number }}</span>
                            {% else %}
                                <span style="color: var(--text-muted);">-</span>
                            {% endif %}
                        </td>
                        <td style="text-align: center;">
                            {% if m.scheduled_time %}
                                <span class="badge badge-info">{{ m.scheduled_time }}</span>
                            {% else %}
                                <span style="color: var(--text-muted);">-</span>
                            {% endif %}
                        </td>
                        <td>
                            <strong>{{ m.player1.nombre }} {{ m.player1.apellido }}</strong>
                            <span class="badge badge-secondary" style="margin-left: 0.5rem;">{{ m.player1.pais_cd }}</span>
                        </td>
                        <td style="text-align: center; color: var(--text-muted);">vs</td>
                        <td>
                            <strong>{{ m.player2.nombre }} {{ m.player2.apellido }}</strong>
                            <span class="badge badge-secondary" style="margin-left: 0.5rem;">{{ m.player2.pais_cd }}</span>
                        </td>
                        <td style="text-align: center;">
                            {% if m.match.status == 'WALKOVER' %}
                                {% if m.match.winner_id == m.player1.id %}
                                    <span class="badge badge-warning">3-0 (WO)</span>
                                {% else %}
                                    <span class="badge badge-warning">0-3 (WO)</span>
                                {% endif %}
                            {% elif m.match.status != 'pending' %}
                                <span class="badge badge-success" style="font-size: 1rem;">{{ m.player1_sets }}-{{ m.player2_sets }}</span>
                            {% else %}
                                <span class="badge badge-secondary">-</span>
                            {% endif %}
                        </td>
                        <td style="text-align: center;">
                            {% if m.match.status == 'pending' %}
                                <span class="badge badge-secondary">Pendiente</span>
                            {% elif m.match.status == 'WALKOVER' %}
                                <span class="badge badge-warning">Walkover</span>
                            {% else %}
                                <span class="badge badge-success">Completado</span>
                            {% endif %}
                        </td>
                        <td style="text-align: center;">
                            <div class="d-flex gap-1" style="justify-content: center;">
                                {% if m.match.status == 'pending' %}
                                    <a href="/match/{{ m.match.id }}/enter-result"
                                       class="btn btn-success btn-sm"
                                       title="Ingresar resultado"
                                       style="padding: 0.25rem 0.5rem;">
                                        ‚úì
                                    </a>
                                {% else %}
                                    <a href="/match/{{ m.match.id }}/enter-result"
                                       class="btn btn-warning btn-sm"
                                       title="Editar resultado"
                                       style="padding: 0.25rem 0.5rem;">
                                        ‚úé
                                    </a>
                                    <form action="/match/{{ m.match.id }}/delete-result" method="post" style="display:inline;" data-confirm="¬øEst√° seguro de eliminar este resultado?">
                                        <button type="submit"
                                                class="btn btn-danger btn-sm"
                                                title="Eliminar resultado"
                                                style="padding: 0.25rem 0.5rem;">
                                            ‚úï
                                        </button>
                                    </form>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
