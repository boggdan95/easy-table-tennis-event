{% extends "base.html" %}

{% block title %}Hoja Grupo {{ group.name }} - ETTEM{% endblock %}

{% block page_title %}Grupo {{ group.name }} - Hoja{% endblock %}

{% block topbar_actions %}
<a href="/category/{{ category }}" class="btn btn-secondary btn-sm">
    <span>‚Üê</span>
    <span>Volver</span>
</a>
{% endblock %}

{% block content %}
<!-- Navigation Card -->
<div class="card mb-3">
    <div class="card-body">
        <div class="d-flex gap-2">
            <a href="/group/{{ group.id }}/matches" class="btn btn-primary">
                <span>üìã</span>
                <span>Ver Lista de Partidos</span>
            </a>
            <a href="/group/{{ group.id }}/standings" class="btn btn-success">
                <span>üìä</span>
                <span>Ver Clasificaci√≥n Final</span>
            </a>
        </div>
    </div>
</div>

<!-- Group Sheet Card -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">üìÑ Matriz de Resultados (Orden Original de Sorteo)</h3>
    </div>
    <div class="card-body" style="padding: 0; overflow-x: auto;">
<table class="group-sheet-matrix">
    <thead>
        <tr>
            <th>Pos</th>
            <th>Jugador</th>
            {% for p in players %}
            <th>{{ p.player.group_number }}</th>
            {% endfor %}
            <th>Pts</th>
            <th>V-D</th>
            <th>Sets</th>
            <th>Puntos</th>
        </tr>
    </thead>
    <tbody>
        {% for p in players %}
        <tr>
            <td><strong>{{ p.player.group_number }}</strong></td>
            <td>{{ p.player.nombre }} {{ p.player.apellido }}</td>
            {% for opponent in players %}
                {% if p.player.id == opponent.player.id %}
                <td class="matrix-diagonal">X</td>
                {% else %}
                    {% set result = results_matrix.get(p.player.group_number, {}).get(opponent.player.group_number) %}
                    {% if result %}
                        {% if result == "WO" %}
                        <td class="matrix-wo">{{ result }}</td>
                        {% else %}
                        <td class="matrix-result">{{ result }}</td>
                        {% endif %}
                    {% else %}
                    <td class="matrix-pending">-</td>
                    {% endif %}
                {% endif %}
            {% endfor %}
            <td><strong>{{ p.standing.points_total if p.standing else 0 }}</strong></td>
            <td>{{ p.standing.wins if p.standing else 0 }}-{{ p.standing.losses if p.standing else 0 }}</td>
            <td>{{ p.standing.sets_w if p.standing else 0 }}-{{ p.standing.sets_l if p.standing else 0 }}</td>
            <td>{{ p.standing.points_w if p.standing else 0 }}-{{ p.standing.points_l if p.standing else 0 }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
    </div>
    <div class="card-footer" style="margin-top: 1rem; border-top: 2px solid #e0e0e0; padding-top: 1rem;">
        <details style="background: #e3f2fd; border-radius: 8px; border: 1px solid #90caf9;">
            <summary style="padding: 0.75rem 1rem; cursor: pointer; font-weight: 600; color: #1976d2; list-style: none; display: flex; align-items: center; gap: 0.5rem;">
                <span class="details-arrow">‚ñ∂</span>
                <span>‚ÑπÔ∏è</span>
                <span>Nota sobre la Hoja de Grupo</span>
            </summary>
            <ul style="margin: 0; padding: 0.5rem 1rem 1rem 2.5rem; color: #555; line-height: 1.8;">
                <li>La posici√≥n en la tabla es el orden original de sorteo (snake seeding)</li>
                <li>Los n√∫meros en las columnas representan la posici√≥n asignada en el grupo</li>
                <li>La matriz muestra el resultado desde la perspectiva del jugador de la fila</li>
                <li>Para ver la clasificaci√≥n final ordenada por puntos, click en "Ver Clasificaci√≥n Final"</li>
            </ul>
        </details>
    </div>
</div>

<style>
.group-sheet-matrix {
    border-collapse: collapse;
    width: 100%;
    margin-top: 10px;
}

.group-sheet-matrix th,
.group-sheet-matrix td {
    border: 1px solid #ccc;
    padding: 10px 8px;
    text-align: center;
}

.group-sheet-matrix th {
    background: linear-gradient(135deg, #4CAF50, #388E3C);
    color: white;
    font-weight: 600;
    font-size: 0.9rem;
}

.group-sheet-matrix tbody tr:nth-child(even) {
    background-color: #f9f9f9;
}

.group-sheet-matrix tbody tr:hover {
    background-color: #e3f2fd;
}

.matrix-diagonal {
    background: linear-gradient(135deg, #9E9E9E, #616161);
    color: white;
    font-weight: bold;
}

.matrix-result {
    background-color: #e8f5e9;
    font-weight: bold;
    color: #2e7d32;
}

.matrix-wo {
    background-color: #fff3e0;
    font-weight: bold;
    color: #ff6f00;
}

.matrix-pending {
    background-color: #fafafa;
    color: #999;
}

.group-sheet-matrix td:first-child {
    background: linear-gradient(135deg, #e3f2fd, #fff);
    font-weight: bold;
    border-right: 2px solid #2196F3;
}

.group-sheet-matrix td:nth-child(2) {
    text-align: left;
    white-space: nowrap;
}

/* Collapsible arrow */
details .details-arrow {
    transition: transform 0.2s;
    font-size: 0.8rem;
}
details[open] .details-arrow {
    transform: rotate(90deg);
}
</style>
{% endblock %}
