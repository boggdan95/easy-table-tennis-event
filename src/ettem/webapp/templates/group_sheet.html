{% extends "base.html" %}

{% block title %}Hoja Grupo {{ group.name }} - ETTEM{% endblock %}

{% block page_title %}Grupo {{ group.name }} - Hoja{% endblock %}

{% block topbar_actions %}
<a href="/category/{{ category }}" class="btn btn-secondary btn-sm">
    <span>‚Üê</span>
    <span>Volver</span>
</a>
{% endblock %}

{% block content %}
<!-- Navigation Card -->
<div class="card mb-3">
    <div class="card-body">
        <div class="d-flex gap-2">
            <a href="/group/{{ group.id }}/matches" class="btn btn-primary">
                <span>üìã</span>
                <span>Ver Lista de Partidos</span>
            </a>
            <a href="/group/{{ group.id }}/standings" class="btn btn-success">
                <span>üìä</span>
                <span>Ver Clasificaci√≥n Final</span>
            </a>
        </div>
    </div>
</div>

<!-- Group Sheet Card -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">üìÑ Matriz de Resultados (Orden Original de Sorteo)</h3>
    </div>
    <div class="card-body" style="padding: 0; overflow-x: auto;">
<table class="group-sheet-matrix">
    <thead>
        <tr>
            <th>Pos</th>
            <th>Jugador</th>
            {% for p in players %}
            <th>{{ p.player.group_number }}</th>
            {% endfor %}
            <th>Pts</th>
            <th>V-D</th>
            <th>Sets</th>
            <th>Puntos</th>
        </tr>
    </thead>
    <tbody>
        {% for p in players %}
        <tr>
            <td><strong>{{ p.player.group_number }}</strong></td>
            <td>{{ p.player.nombre }} {{ p.player.apellido }}</td>
            {% for opponent in players %}
                {% if p.player.id == opponent.player.id %}
                <td class="matrix-diagonal">X</td>
                {% else %}
                    {% set result = results_matrix.get(p.player.group_number, {}).get(opponent.player.group_number) %}
                    {% if result %}
                        {% if result == "WO" %}
                        <td class="matrix-wo">{{ result }}</td>
                        {% else %}
                        <td class="matrix-result">{{ result }}</td>
                        {% endif %}
                    {% else %}
                    <td class="matrix-pending">-</td>
                    {% endif %}
                {% endif %}
            {% endfor %}
            <td><strong>{{ p.standing.points_total if p.standing else 0 }}</strong></td>
            <td>{{ p.standing.wins if p.standing else 0 }}-{{ p.standing.losses if p.standing else 0 }}</td>
            <td>{{ p.standing.sets_w if p.standing else 0 }}-{{ p.standing.sets_l if p.standing else 0 }}</td>
            <td>{{ p.standing.points_w if p.standing else 0 }}-{{ p.standing.points_l if p.standing else 0 }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
    </div>
    <div class="card-footer">
        <div class="alert alert-info" style="margin: 0;">
            <span class="icon">‚ÑπÔ∏è</span>
            <div class="alert-content">
                <div class="alert-title">Nota sobre la Hoja de Grupo</div>
                <ul style="margin: 0.5rem 0 0 1.5rem; padding: 0; line-height: 1.8;">
                    <li>La posici√≥n en la tabla es el orden original de sorteo (snake seeding)</li>
                    <li>Los n√∫meros en las columnas representan la posici√≥n asignada en el grupo</li>
                    <li>La matriz muestra el resultado desde la perspectiva del jugador de la fila</li>
                    <li>Para ver la clasificaci√≥n final ordenada por puntos, click en "Ver Clasificaci√≥n Final"</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<style>
.group-sheet-matrix {
    border-collapse: collapse;
    width: 100%;
    margin-top: 10px;
}

.group-sheet-matrix th,
.group-sheet-matrix td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
}

.group-sheet-matrix th {
    background: linear-gradient(135deg, var(--success-color), var(--success-dark));
    color: white;
    font-weight: 600;
}

.group-sheet-matrix tbody tr:nth-child(even) {
    background-color: var(--card-bg-secondary);
}

.group-sheet-matrix tbody tr:hover {
    background-color: var(--primary-light);
}

.matrix-diagonal {
    background: linear-gradient(135deg, var(--secondary-color), var(--secondary-dark));
    color: white;
    font-weight: bold;
}

.matrix-result {
    background-color: #e8f5e9;
    font-weight: bold;
}

.matrix-wo {
    background-color: #fff3e0;
    font-weight: bold;
    color: #ff6f00;
}

.matrix-pending {
    background-color: #fafafa;
    color: #999;
}

.group-sheet-matrix td:first-child {
    background: linear-gradient(135deg, var(--primary-light), #fff);
    font-weight: bold;
    border-right: 2px solid var(--primary-color);
}
</style>
{% endblock %}
