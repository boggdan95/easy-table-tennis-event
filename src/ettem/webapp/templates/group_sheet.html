{% extends "base.html" %}
{% block title %}Hoja Grupo {{ group.name }} - ETTEM{% endblock %}
{% block content %}
<h1>Grupo {{ group.name }} - Hoja de Grupo</h1>
<p>
    <a href="/category/{{ category }}" class="btn">Volver a Categoria</a>
    <a href="/group/{{ group.id }}/standings" class="btn">Ver Clasificacion Final</a>
    <a href="/group/{{ group.id }}/matches" class="btn">Ver Lista de Partidos</a>
</p>

<h2>Resultados (Orden Original de Sorteo)</h2>
<table class="group-sheet-matrix">
    <thead>
        <tr>
            <th>Pos</th>
            <th>Jugador</th>
            {% for p in players %}
            <th>{{ p.player.group_number }}</th>
            {% endfor %}
            <th>Pts</th>
            <th>V-D</th>
            <th>Sets</th>
            <th>Puntos</th>
        </tr>
    </thead>
    <tbody>
        {% for p in players %}
        <tr>
            <td><strong>{{ p.player.group_number }}</strong></td>
            <td>{{ p.player.nombre }} {{ p.player.apellido }}</td>
            {% for opponent in players %}
                {% if p.player.id == opponent.player.id %}
                <td class="matrix-diagonal">X</td>
                {% else %}
                    {% set result = results_matrix.get(p.player.group_number, {}).get(opponent.player.group_number) %}
                    {% if result %}
                        {% if result == "WO" %}
                        <td class="matrix-wo">{{ result }}</td>
                        {% else %}
                        <td class="matrix-result">{{ result }}</td>
                        {% endif %}
                    {% else %}
                    <td class="matrix-pending">-</td>
                    {% endif %}
                {% endif %}
            {% endfor %}
            <td><strong>{{ p.standing.points_total if p.standing else 0 }}</strong></td>
            <td>{{ p.standing.wins if p.standing else 0 }}-{{ p.standing.losses if p.standing else 0 }}</td>
            <td>{{ p.standing.sets_w if p.standing else 0 }}-{{ p.standing.sets_l if p.standing else 0 }}</td>
            <td>{{ p.standing.points_w if p.standing else 0 }}-{{ p.standing.points_l if p.standing else 0 }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div style="margin-top: 20px; font-size: 0.9em; color: #666;">
    <p><strong>Nota:</strong></p>
    <ul>
        <li>La posicion en la tabla es el orden original de sorteo (snake seeding)</li>
        <li>Los numeros en las columnas representan la posicion asignada en el grupo</li>
        <li>La matriz muestra el resultado desde la perspectiva del jugador de la fila</li>
        <li>Para ver la clasificacion final ordenada por puntos, click en "Ver Clasificacion Final"</li>
    </ul>
</div>

<style>
.group-sheet-matrix {
    border-collapse: collapse;
    width: 100%;
    margin-top: 10px;
}

.group-sheet-matrix th,
.group-sheet-matrix td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
}

.group-sheet-matrix th {
    background-color: #4CAF50;
    color: white;
}

.group-sheet-matrix tbody tr:nth-child(even) {
    background-color: #f2f2f2;
}

.matrix-diagonal {
    background-color: #333;
    color: white;
    font-weight: bold;
}

.matrix-result {
    background-color: #e8f5e9;
    font-weight: bold;
}

.matrix-wo {
    background-color: #fff3e0;
    font-weight: bold;
    color: #ff6f00;
}

.matrix-pending {
    background-color: #fafafa;
    color: #999;
}

.group-sheet-matrix td:first-child {
    background-color: #e3f2fd;
    font-weight: bold;
}
</style>
{% endblock %}
